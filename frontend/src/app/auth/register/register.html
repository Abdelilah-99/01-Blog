<div class="register-container">
  <!-- Error Message Toast -->
  <div *ngIf="errorMessage" class="error-toast">
    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
      <path
        d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M8 4a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0l.35-3.507A.905.905 0 0 0 8 4m.002 6a1 1 0 1 0 0 2 1 1 0 0 0 0-2" />
    </svg>
    <span>{{ errorMessage }}</span>
    <button class="close-error-btn" (click)="errorMessage = null">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
        <path
          d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z" />
      </svg>
    </button>
  </div>
  <div class="container-fluid">
    <div class="row justify-content-center align-items-center min-vh-100">
      <div class="col-12 col-sm-10 col-md-8 col-lg-6 col-xl-5">
        <div class="register-card">
          <div class="register-header">
            <h2><i class="bi bi-stars me-2"></i>Rejoignez-nous</h2>
            <p>Créez votre compte pour commencer</p>
            <div class="step-indicator">
              <div class="step" [class.active]="currentStep === 1" [class.completed]="currentStep > 1">
                <div class="step-number">1</div>
                <span class="step-label">Informations</span>
              </div>
              <div class="step-divider"></div>
              <div class="step" [class.active]="currentStep === 2">
                <div class="step-number">2</div>
                <span class="step-label">Sécurité</span>
              </div>
            </div>
          </div>
          <form (ngSubmit)="onRegister()" class="register-form" novalidate>
            <div *ngIf="currentStep === 1" class="form-step">
              <div class="row">
                <div class="col-md-6 mb-3 form-group">
                  <label for="firstname" class="form-label">
                    <i class="bi bi-person me-2"></i>Prénom
                  </label>
                  <input type="text" maxlength="15" id="firstname" [(ngModel)]="firstname" name="firstname"
                    placeholder="Saisissez votre prénom" required class="form-control form-input">
                  <div class="char-count-hint">
                  </div>
                </div>

                <div class="col-md-6 mb-3 form-group">
                  <label for="lastname" class="form-label">
                    <i class="bi bi-person-check me-2"></i>Nom de famille
                  </label>
                  <input type="text" maxlength="15" id="lastname" [(ngModel)]="lastname" name="lastname"
                    placeholder="Saisissez votre nom de famille" required class="form-control form-input">
                  <div class="char-count-hint">
                  </div>
                </div>
              </div>

              <div class="mb-3 form-group">
                <label for="username" class="form-label">
                  <i class="bi bi-at me-2"></i>Nom d'utilisateur
                </label>
                <input type="text" maxlength="50" id="username" [(ngModel)]="username" name="username"
                  placeholder="Choisissez un nom d'utilisateur" required class="form-control form-input">
                <div class="char-count-hint">
                </div>
              </div>

              <div class="mb-3 form-group">
                <label for="email" class="form-label">
                  <i class="bi bi-envelope-heart me-2"></i>Adresse email
                </label>
                <input type="email" maxlength="100" id="email" [(ngModel)]="email" name="email"
                  placeholder="Saisissez votre adresse email" required class="form-control form-input">
              </div>

              <div class="d-grid gap-2">
                <button type="button" (click)="nextStep()" [disabled]="!isStep1Valid()" class="btn register-button"
                  [class.disabled]="!isStep1Valid()">
                  <span>Suivant</span>
                  <i class="bi bi-arrow-right ms-2"></i>
                </button>
              </div>
            </div>

            <div *ngIf="currentStep === 2" class="form-step">
              <div class="mb-3 form-group">
                <label for="password" class="form-label">
                  <i class="bi bi-shield-lock me-2"></i>Mot de passe
                </label>
                <input type="password" maxlength="10" id="password" [(ngModel)]="password" name="password"
                  placeholder="Créez un mot de passe sécurisé" required class="form-control form-input">
              </div>

              <div class="mb-4 form-group">
                <label for="profileImage" class="form-label">
                  <i class="bi bi-camera me-2"></i>Photo de profil (Optionnel)
                </label>
                <div class="file-input-wrapper">
                  <input type="file" id="profileImage" (change)="onFileSelected($event)" accept="image/*"
                    class="form-control file-input">
                  <label for="profileImage" class="file-input-label btn btn-outline-secondary"
                    *ngIf="!profileImagePreview">
                    <i class="bi bi-cloud-upload me-2"></i>
                    <span class="file-input-text">Choisir une photo</span>
                  </label>
                  <!-- <div *ngIf="message">{{message}}</div> -->
                </div>
                <div *ngIf="profileImagePreview" class="profile-image-preview">
                  <img [src]="profileImagePreview" alt="Profile Preview">
                  <button type="button" class="remove-profile-btn" (click)="removeProfileImage()">
                    <i class="bi bi-trash"></i> Supprimer
                  </button>
                </div>
              </div>

              <div class="d-grid gap-2">
                <button type="submit" [disabled]="!isStep2Valid()" class="btn register-button"
                  [class.disabled]="!isStep2Valid()">
                  <i class="bi bi-person-plus-fill me-2"></i>Créer mon compte
                </button>
                <button type="button" (click)="previousStep()" class="btn btn-secondary back-button">
                  <i class="bi bi-arrow-left me-2"></i>Retour
                </button>
              </div>
            </div>
          </form>

          <div class="login-link">
            <p class="text-muted">Vous avez déjà un compte ?
              <a routerLink="/login" class="login-link-text text-decoration-none">
                <i class="bi bi-door-open me-1"></i>Se connecter
              </a>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>